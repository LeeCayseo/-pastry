<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Webcam Snap Overlay</title>
    <style>
      body { margin: 0; overflow: hidden; }
      canvas { display: block; }
    </style>
  </head>
  <body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <script>
      let cam;
      let snapshots = [];
      let SNAP_SIZE;

      function isMobile() {
        return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
      }

      function setup() {
        createCanvas(windowWidth, windowHeight);

        // ê¸°ê¸°ì— ë”°ë¼ SNAP_SIZE ì„¤ì •
        SNAP_SIZE = isMobile() ? 300 : 200;

        let constraints;

        if (isMobile()) {
          // ğŸ“± ëª¨ë°”ì¼ì¼ ê²½ìš° í›„ë©´ ì¹´ë©”ë¼
          constraints = {
            audio: false,
            video: {
              facingMode: { exact: "environment" }
            }
          };
        } else {
          // ğŸ’» PC ì›¹ì¼ ê²½ìš° ê¸°ë³¸ ì›¹ìº 
          constraints = {
            audio: false,
            video: true
          };
        }

        cam = createCapture(constraints, function(stream) {
          console.log("Camera initialized");
        });
        cam.size(windowWidth, windowHeight);
        cam.hide();
      }

      function draw() {
        // ìº  ì˜ìƒ ì¢Œìš° ë°˜ì „í•´ì„œ ì¶œë ¥
        push();
        translate(width, 0);
        scale(-1, 1);
        image(cam, 0, 0, width, height);
        pop();

        // ìº¡ì²˜ëœ ìŠ¤ëƒ…ìƒ·ì€ ì›ë˜ ë°©í–¥ëŒ€ë¡œ ì¶œë ¥
        for (let snap of snapshots) {
          image(snap.img, snap.x, snap.y, SNAP_SIZE, SNAP_SIZE);
          noFill();
          stroke(255, 0, 255);
          strokeWeight(2);
          rect(snap.x, snap.y, SNAP_SIZE, SNAP_SIZE);
        }
      }

      // í„°ì¹˜ ë˜ëŠ” í´ë¦­ ëŒ€ì‘
      function mousePressed() {
        takeSnapshot();
      }

      function touchStarted() {
        takeSnapshot();
        return false; // ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤ ë°©ì§€
      }

      function takeSnapshot() {
        const sx = constrain(mouseX - SNAP_SIZE / 2, 0, width - SNAP_SIZE);
        const sy = constrain(mouseY - SNAP_SIZE / 2, 0, height - SNAP_SIZE);
        const img = cam.get(sx, sy, SNAP_SIZE, SNAP_SIZE);
        snapshots.push({ x: sx, y: sy, img });
      }
    </script>
  </body>
</html>
