<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Webcam Snap Overlay</title>
    <style>
      body { margin: 0; overflow: hidden; }
      canvas { display: block; }
    </style>
  </head>
  <body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <script>
      let cam;
      let snapshots = [];
      const SNAP_SIZE = 300; // 모바일 화면에 맞게 300으로 줄였습니다.

      function setup() {
        createCanvas(windowWidth, windowHeight);

        // 모바일에서 후면 카메라 사용
        const constraints = {
          audio: false,
          video: {
            facingMode: { exact: "environment" }  // 후면 카메라 요청
          }
        };

        cam = createCapture(constraints, function(stream) {
          console.log("Camera initialized");
        });
        cam.size(windowWidth, windowHeight);
        cam.hide();
      }

      function draw() {
        image(cam, 0, 0, width, height);

        for (let snap of snapshots) {
          image(snap.img, snap.x, snap.y, SNAP_SIZE, SNAP_SIZE);
          noFill();
          stroke(255, 0, 255);
          strokeWeight(2);
          rect(snap.x, snap.y, SNAP_SIZE, SNAP_SIZE);
        }
      }

      function touchStarted() {
        const sx = constrain(mouseX - SNAP_SIZE / 2, 0, width - SNAP_SIZE);
        const sy = constrain(mouseY - SNAP_SIZE / 2, 0, height - SNAP_SIZE);
        const img = cam.get(sx, sy, SNAP_SIZE, SNAP_SIZE);
        snapshots.push({ x: sx, y: sy, img });
        return false; // 모바일 스크롤 방지
      }
    </script>
  </body>
</html>
